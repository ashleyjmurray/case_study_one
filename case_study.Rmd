---
title: "case_study"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# THIS IS OUR MODEL
$$
T_i \sim Weibull(\alpha, \mu) \\
log(\mu) = \beta_0 + \beta_1x_{i1}+\beta_2x_{i2}+...+\beta_px_{ip}\\
$$
Log of mu is done so that the mu parameter is always positive (the support on mu in Weibull is that mu > 0)

According to Graham, the following is being done by the model above. So basically Stander et al is doing cox proportional, but they just didn't write out this hazard function explicity in the paper.
$$
h_i(t)=h_0(t)\exp(\beta_1x_{i1}+\beta_2x_{i2}+...+\beta_px_{ip}) \\
$$
hazard of death is a rate -- instantaneous failure rate (probability is integral from 0 to J over it dt)

$$
f(t) = \alpha\lambda t^{\alpha-1}\exp(-\lambda t^\alpha)
$$
run JAGS mcmc on the betas, follow Stander et al code as a guide





```{r}
leaders_data <- get(load("Leaders.RData"))
```

```{r}
library(dynsurv)
library(survival)
data(tooth)
```


```{r}
library(tidyverse)
mydata = leaders_data
mygrid <- tooth.grid # Amy said the time variable is not relevant
myformula <- Surv(leaders_data$Birth.Date, leaders_data$Event.Date, type = "interval2") ~ leaders_data$Birth.Date + leaders_data$Type
```

# https://amy-herring.github.io/STA440/decks/survival.html#/proportional-hazards-models
# generate predictive samples of Obama and Naruhito, then do Pr(B0+B1 > B1+B2)
# < 1.02 Rhat and > 200 n.eff
# bayes plot package

```{r}
fit <- bayesCox(myformula, mydata, mygrid, 
                 out = "leadersCox.txt", 
                 model = "TimeIndep", 
                 base.prior = list(type = "Gamma", shape = 0.1, rate = 0.1),    
                 coef.prior = list(type = "Normal", mean = 0, sd = 1),  
                 gibbs = list(iter = 100, burn = 20, thin = 1, verbose = TRUE, nReport = 5))
plotCoef(coef(fit, level = 0.9))
```
```{r}
# https://www.rdocumentation.org/packages/dynsurv/versions/0.3-3/topics/bayesCox
mydata0 <- tooth
mygrid0 = tooth.grid
myformula0<- Surv(left, right, type = "interval2") ~ dmf + sex
```

```{r}
fit0 <- bayesCox(myformula0, mydata0, mygrid0, out = "tiCox.txt",
                 model = "TimeIndep",
                 base.prior = list(type = "Gamma", shape = 0.1, rate = 0.1),
                 coef.prior = list(type = "Normal", mean = 0, sd = 1),
                 gibbs = list(iter = 100, burn = 20, thin = 1, verbose = TRUE, nReport = 5))
plotCoef(coef(fit0, level = 0.9))
```
