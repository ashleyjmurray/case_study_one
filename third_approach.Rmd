---
title: "Predicting the Lifespan of World Leaders"
author: "Cathy Lee, Alice Liao, Ashley Murray, and Matty Pahren"
date: "8-30-20"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# I. Introduction

World leaders are influential people that have the power to impact millions of people's lives. Some leaders are elected for terms while others serve for life, so their expected survival is of great interest. In this paper, we seek to examine Popes, US Presidents, Dalai Lamas, Chinese Emperors, and Japanese Emperors to see how their lifespans compare. Additionally, we want to analyze the impact of a leader's birth year on survival, and whether or not this impact might vary depending on the type of leadership. After we build a model to analyze the effects, we also wish to look at some specific cases and determine the probability that the current 14th Dalai Lama will outlive Pope Francis and the probability that President Obama will outlive Emperor Naruhito. We will accomplish this by using survival analysis. We use Bayesian Inference to estimate the model parameters with the help of the JAGS program. 

The rest of the paper is structured as follows. First, we will describe the data used to carry out our analysis. Next, we will describe the methods used in our analysis plan. Then, we will show how we carried out our analysis plan and recount our results. After that, we discuss our conclusions and areas for further research. Finally, our code and some additional information can be found in the Appendix. 


# II. Data

## II a. Description of the Data

The data used in this analysis contains entries for 177 different world leaders. The types of world leaders present in the data include Popes, US Presidents, Dalai Lamas, Chinese Emperors, and Japanese Emperors. Each leader's birth date and their type of leadership is recorded. For some of these groups, we have data dating all the way back to the 14th century. Additionally, leaders who have passed away also have their death date and age of death recorded. For leaders that are still living, these columns instead contain the date the dataset was created (July 31, 2020) and their current age on that date. In order to further clarify who is dead or alive, there is a column titled "Censored," which takes a value of 0 if the person is dead and a value of 1 if that person is still alive. Related to this, there is another column called "Fail," which takes on a value of 1 if the person is dead and a value of 0 if the person is alive. In total, there are 10 living leaders in our dataset, 4 of whose age of death we are trying to predict. 

```{r, message=F, include=F}
# import libraries
library(R2jags)
library(tidyverse)
library(ggplot2)
library(lubridate)
install.packages("TruncatedDistributions", repos="http://R-Forge.R-project.org") 
library(TruncatedDistributions)
library(knitr)
library(broom)
library(coda)
library(gridExtra)
library(grid)
```

```{r, include=F}
# clean data and make sure columns have the right type
leaders_data <- get(load("Leaders.RData"))
leaders_data$Censored[leaders$Name == "Jianwen Emperor"] <- "0" #typo for Jianwen Emperor

# reset censoring end date
leaders_data = leaders_data %>%
  mutate(Event.Date = case_when(
    Censored == 1 ~ as.Date("2020-08-31"),
    TRUE ~ Event.Date
  )) %>%
  mutate(Age.Event = as.numeric(time_length(difftime(Event.Date, Birth.Date), "years")))

leaders_data$Censored <- as.factor(leaders_data$Censored)
leaders_data$Type <- as.factor(leaders_data$Type)
leaders_data$Age.Event <- as.numeric(leaders_data$Age.Event)

summary(leaders_data)

# create birth year
leaders_data$Birth.Year <- year(leaders_data$Birth.Date)
```

## II b. Exploratory Data Analysis

```{r, fig.height = 2, fig.wdith=5, echo=F}
ggplot(data=leaders_data, aes(x=Birth.Year, y = Age.Event, color = Type)) +geom_point() + geom_smooth(method="lm", se = F)
```

Based on this scatterplot, it appears that birth year's association with lifespan does depends on type of leadership.

```{r, fig.height=2, fig.width=5,echo=F}
# create EDA plots
ggplot(data = leaders_data) +
  geom_boxplot(aes(x = Type, y = Age.Event)) + ggtitle("Distribution of Leader Type and Their Age") + labs(x = "Type of Leader", y = "Age")
```

```{r, fig.height=2, fig.width=5,echo=F}
ggplot(data = leaders_data) +
  geom_histogram(aes(x = Age.Event), binwidth = 5) + ggtitle("Distribution of Leaders Age") + labs(x = "Age")
```

From the boxplot, the distribution of the lifespans of Popes and US Presidents is centered higher, which makes intuitive sense given that these leaders are elected later in life, while Dalai Lamas and Emperors can be elected at much younger ages. For instance, if a person is a toddler and dies at age five, that person can never be president (and therefore would not have their age be part of the dataset). However, that person can become a Dalai Lama as a toddler and have their age at death influence the distribution plotted. Lastly, the distribution of lifespans as seen in the histogram is unimodal and slightly left skewed. However, this skewing does not seem extreme so there is no need for a transformation. 

# III. Methods

## III a. Motivating the Model

We use survival analysis as a way to model $T_i$, the lifespan of a given leader i depending on their year of birth and type of leadership. Survival analysis is useful in that it allows the consideration of "censored" data. This means that we do not always observe the outcome for each data point. For example, we do not know the death date of leaders that are still alive. Thus, we do not know their lifespan, we just know that their survival time $T_i$ will be greater than their current age. 

We model the lifespan $T_i$ of an individual i after the Weibull distribution specified below. We choose to use the Weibull distribution because it is often utilized in survival analysis and allows the user to specify a flexible shape parameter for the distribution. The first parameter $r$, also known as the shape parameter, is a positive scalar, and the second parameter $\mu$, the scale parameter, is a linear function of the covariates (in this case, birth year centered at mean 1667 and types of leadership as well as their interactions). 


$$ T_i \sim Weibull(r, \mu_i) $$
$$\log(\mu_i) = \beta_0+\beta_1 (Year \ of \ Birth_i)+\beta_2 (Leadership_i = UsPres) + \beta_3 (Leadership_i = ChinaEmp) $$
$$+ \beta_4 (Leadership_i = DalaiLama) +\beta_5 (Leadership_i = JapanEmp) \\$$
$$+ \beta_6 (Year \ of \ Birth_i * (Leadership_i = UsPres)) \\$$
$$+ \beta_7 (Year \ of \ Birth_i * (Leadership_i = ChinaEmp)) \\$$
$$+ \beta_8 (Year \ of \ Birth_i * (Leadership_i = DalaiLama)) \\$$
$$+ \beta_9 (Year \ of \ Birth_i * (Leadership_i = JapanEmp))$$
where Leadership_i = Popes is the baseline for comparison.

## III b. Addressing Censored Data

To handle censored observations, we specify their contribution to the likelihood function using the Poisson "zeros trick." Details on this method and how to implement it can be found in Appendix A.1. 

## III c. Prior Choice

We assume that our priors are independent because intuitively a given observation could not be two types of leaders. Additionally, we do not have sufficiently strong prior knowledge about the relationship between birth year and type of leadership to specify an informative prior. Therefore, we use uninformative priors for the betas in our model. For our prior for r, we chose a prior of $exp(1)$, as we believe the hazard of death increases with time. 

```{r, include=F}
# 10 censored data
leaders_data$Name[leaders_data$Censored == "1"]

# create dummy variables
leaders_data <- leaders_data %>%
  mutate(TypeChinaEmp = as.factor(case_when(Type == "ChinaEmp" ~ 1,
                             TRUE ~ 0)),
         TypeDalaiLama = as.factor(case_when(Type == "DalaiLama" ~ 1,
                                   TRUE ~ 0)),
         TypeJapanEmp = as.factor(case_when(Type == "JapanEmp" ~ 1, 
                                  TRUE ~ 0)),
         TypePope = as.factor(case_when(Type == "Pope" ~ 1, 
                              TRUE ~ 0)),
         TypeUsPres = as.factor(case_when(Type == "UsPres" ~ 1,
                                TRUE ~ 0))) %>%
  mutate(Yr14 = as.factor(case_when(year(Birth.Date) <= 1400 ~1,
                                        TRUE ~0)),
         Yr15 = as.factor(case_when(year(Birth.Date) >= 1401 & year(Birth.Date) <= 1500 ~ 1,
                                         TRUE ~0)),
         Yr16 = as.factor(case_when(year(Birth.Date) >= 1501 & year(Birth.Date) <= 1600 ~ 1,
                                         TRUE ~0)),
         Yr17 = as.factor(case_when(year(Birth.Date) >= 1601 & year(Birth.Date) <= 1700 ~ 1,
                                         TRUE ~0)),
         Yr18 = as.factor(case_when(year(Birth.Date) >= 1701 & year(Birth.Date) <= 1800 ~ 1,
                                         TRUE ~0)),
         Yr19 = as.factor(case_when(year(Birth.Date) >= 1801 & year(Birth.Date) <= 1900 ~ 1,
                                         TRUE ~0)),
         Yr20 = as.factor(case_when(year(Birth.Date) >= 1901 & year(Birth.Date) <= 2000 ~ 1,
                                         TRUE ~0))
         ) 


# get rid of those we are trying to predict
leaders_nopred <- leaders_data # %>%
  # filter(!(Name %in% c("14th Dalai Lama (Tenzin Gyatso)", "Naruhito (Emperor Reiwa)", "Barack Obama", "Francis")))

# set the survival and censored vectors
survival_raw <- leaders_nopred$Age.Event
n <- length(survival_raw)

censored <- leaders_nopred$Censored
survival <- ifelse(censored == 0, survival_raw, NA)

censoring_limits <- ifelse(censored == 0, 100, survival_raw)

x_1 <- as.numeric(as.character(leaders_nopred$Yr15))
x_2 <- as.numeric(as.character(leaders_nopred$Yr16))
x_3 <- as.numeric(as.character(leaders_nopred$Yr17))
x_4 <- as.numeric(as.character(leaders_nopred$Yr18))
x_5 <- as.numeric(as.character(leaders_nopred$Yr19))
x_6 <- as.numeric(as.character(leaders_nopred$Yr20))

x_7 <- as.numeric(as.character(leaders_nopred$TypeUsPres))
x_8 <- as.numeric(as.character(leaders_nopred$TypeChinaEmp))
x_9 <- as.numeric(as.character(leaders_nopred$TypeDalaiLama))
x_10 <- as.numeric(as.character(leaders_nopred$TypeJapanEmp))

# add interaction b/w Yr__ and Type___
x_1_7 <- x_1*x_7; x_1_8 <- x_1*x_8; x_1_9 <- x_1*x_9; x_1_10 <- x_1*x_10

x_2_7 <- x_2*x_7
x_2_8 <- x_2*x_8
x_2_9 <- x_2*x_9
x_2_10 <- x_2*x_10

x_3_7 <- x_3*x_7
x_3_8 <- x_3*x_8
x_3_9 <- x_3*x_9
x_3_10 <- x_3*x_10

x_4_7 <- x_4*x_7
x_4_8 <- x_4*x_8
x_4_9 <- x_4*x_9
x_4_10 <- x_4*x_10

x_5_7 <- x_5*x_7
x_5_8 <- x_5*x_8
x_5_9 <- x_5*x_9
x_5_10 <- x_5*x_10

x_6_7 <- x_6*x_7
x_6_8 <- x_6*x_8
x_6_9 <- x_6*x_9
x_6_10 <- x_6*x_10
```

*write based on residual plots, choose binning for time*

```{r, og-model-text, include=F}
# # mcmc sampler function
# set.seed(123)
# build_model <- function() {
#   for(i in 1:n_censored) {
#     z_censored[i] ~ dpois(phi_censored[i])
#     phi_censored[i] <- mu_censored[i] * pow(t_censored[i], r)
#     mu_censored[i] <- exp(beta_censored[i])
#     beta_censored[i] <- beta_0 + beta_1*x_1_censored[i] +
#       beta_2*x_2_censored[i] + beta_3*x_3_censored[i] + beta_4*x_4_censored[i] + beta_5*x_5_censored[i] + beta_6*x_6_censored[i] + beta_7*x_7_censored[i] + beta_8*x_8_censored[i] + beta_9*x_9_censored[i] + beta_10*x_10_censored[i] +
# 
#     beta_1_7*x_1_7_censored[i] + beta_1_8*x_1_8_censored[i] +  beta_1_9*x_1_9_censored[i] + beta_1_10*x_1_10_censored[i] +
# 
#           beta_2_7*x_2_7_censored[i] +
#           beta_2_8*x_2_8_censored[i] +
#           beta_2_9*x_2_9_censored[i] +
#           beta_2_10*x_2_10_censored[i] +
# 
#           beta_3_7*x_3_7_censored[i] +
#           beta_3_8*x_3_8_censored[i] +
#           beta_3_9*x_3_9_censored[i] +
#           beta_3_10*x_3_10_censored[i] +
# 
#           beta_4_7*x_4_7_censored[i] +
#           beta_4_8*x_4_8_censored[i] +
#           beta_4_9*x_4_9_censored[i] +
#           beta_4_10*x_4_10_censored[i] +
# 
#           beta_5_7*x_5_7_censored[i] +
#           beta_5_8*x_5_8_censored[i] +
#           beta_5_9*x_5_9_censored[i] +
#           beta_5_10*x_5_10_censored[i] +
# 
#           beta_6_7*x_6_7_censored[i] +
#           beta_6_8*x_6_8_censored[i] +
#           beta_6_9*x_6_9_censored[i] +
#           beta_6_10*x_6_10_censored[i]
# 
#   }
# 
#   for(j in 1:n_non_censored) { #total rows - 6 ** 6 are censored in leaders_nopred
#     survival_non_censored[j] ~ dweib(r, mu[j])
#     mu[j] <- exp(beta[j])
#     beta[j] <- beta_0 + beta_1*x_1_non_censored[j] +
#       beta_2*x_2_non_censored[j] + beta_3*x_3_non_censored[j] + beta_4*x_4_non_censored[j] + beta_5*x_5_non_censored[j] + beta_6*x_6_non_censored[j] + beta_7*x_7_non_censored[j] + beta_8*x_8_non_censored[j] + beta_9*x_9_non_censored[j] + beta_10*x_10_non_censored[j] +
# 
#     beta_1_7*x_1_7_non_censored[j] + beta_1_8*x_1_8_non_censored[j] +  beta_1_9*x_1_9_non_censored[j] + beta_1_10*x_1_10_non_censored[j] +
# 
#           beta_2_7*x_2_7_non_censored[j] +
#           beta_2_8*x_2_8_non_censored[j] +
#           beta_2_9*x_2_9_non_censored[j] +
#           beta_2_10*x_2_10_non_censored[j] +
# 
#           beta_3_7*x_3_7_non_censored[j] +
#           beta_3_8*x_3_8_non_censored[j] +
#           beta_3_9*x_3_9_non_censored[j] +
#           beta_3_10*x_3_10_non_censored[j] +
# 
#           beta_4_7*x_4_7_non_censored[j] +
#           beta_4_8*x_4_8_non_censored[j] +
#           beta_4_9*x_4_9_non_censored[j] +
#           beta_4_10*x_4_10_non_censored[j] +
# 
#           beta_5_7*x_5_7_non_censored[j] +
#           beta_5_8*x_5_8_non_censored[j] +
#           beta_5_9*x_5_9_non_censored[j] +
#           beta_5_10*x_5_10_non_censored[j] +
# 
#           beta_6_7*x_6_7_non_censored[j] +
#           beta_6_8*x_6_8_non_censored[j] +
#           beta_6_9*x_6_9_non_censored[j] +
#           beta_6_10*x_6_10_non_censored[j]
#   }
# 
# 
# 
#   beta_0 ~ dnorm(0.0, 1.0E-3) # Prior on beta_0 is normal with low precision
#   beta_1 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_2 ~ dnorm(0.0, 1.0E-3) # Prior on beta_2 is normal with low precision
#   beta_3 ~ dnorm(0.0, 1.0E-3) # Prior on beta_3 is normal with low precision
#   beta_4 ~ dnorm(0.0, 1.0E-3) # Prior on beta_4 is normal with low precision
#   beta_5 ~ dnorm(0.0, 1.0E-3) # Prior on beta_5 is normal with low precision
#   beta_6 ~ dnorm(0.0, 1.0E-3) # Prior on beta_6 is normal with low precision
#   beta_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_7 is normal with low precision
#   beta_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_8 is normal with low precision
#   beta_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_9 is normal with low precision
#   beta_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_1_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_1_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_1_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_1_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_2_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_2_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_2_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_2_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_3_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_3_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_3_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_3_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_4_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_4_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_4_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_4_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_5_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_5_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_5_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_5_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_6_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_6_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_6_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
#   beta_6_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
# 
#   r ~ dexp(0.1) # Prior on r
# 
# 
#   #Define alphas
#   alpha_0 <- - beta_0 / r
#   alpha_1 <- - beta_1 / r
#   alpha_2 <- - beta_2 / r
#   alpha_3 <- - beta_3 / r
#   alpha_4 <- - beta_4 / r
#   alpha_5 <- - beta_5 / r
#   alpha_6 <- - beta_6 / r
#   alpha_7 <- - beta_7 / r
#   alpha_8 <- - beta_8 / r
#   alpha_9 <- - beta_9 / r
#   alpha_10 <- - beta_10 / r
#   alpha_1_7 <- - beta_1_7 / r
#   alpha_1_8 <- - beta_1_8 / r
#   alpha_1_9 <- - beta_1_9 / r
#   alpha_1_10 <- - beta_1_10 / r
# 
#   alpha_2_7 <- - beta_2_7 / r
#   alpha_2_8 <- - beta_2_8 / r
#   alpha_2_9 <- - beta_2_9 / r
#   alpha_2_10 <- - beta_2_10 / r
# 
#   alpha_3_7 <- - beta_3_7 / r
#   alpha_3_8 <- - beta_3_8 / r
#   alpha_3_9 <- - beta_3_9 / r
#   alpha_3_10 <- - beta_3_10 / r
# 
#   alpha_4_7 <- - beta_4_7 / r
#   alpha_4_8 <- - beta_4_8 / r
#   alpha_4_9 <- - beta_4_9 / r
#   alpha_4_10 <- - beta_4_10 / r
# 
#   alpha_5_7 <- - beta_5_7 / r
#   alpha_5_8 <- - beta_5_8 / r
#   alpha_5_9 <- - beta_5_9 / r
#   alpha_5_10 <- - beta_5_10 / r
# 
#   alpha_6_7 <- - beta_6_7 / r
#   alpha_6_8 <- - beta_6_8 / r
#   alpha_6_9 <- - beta_6_9 / r
#   alpha_6_10 <- - beta_6_10 / r
# 
# 
#   # Percentage increases
#   p_i_Yr15 <- 100*(exp(alpha_1) - 1)
#   p_i_Yr16 <- 100*(exp(alpha_2) - 1)
#   p_i_Yr17 <- 100*(exp(alpha_3) - 1)
#   p_i_Yr18 <- 100*(exp(alpha_4) - 1)
#   p_i_Yr19 <- 100*(exp(alpha_5) - 1)
#   p_i_Yr20 <- 100*(exp(alpha_6) - 1)
#   p_i_UsPres <- 100*(exp(alpha_7) - 1)
#   p_i_ChinaEmp <- 100*(exp(alpha_8) - 1)
#   p_i_DalaiLama <- 100*(exp(alpha_9) - 1)
#   p_i_JapanEmp <- 100*(exp(alpha_10) - 1)
# 
#   p_i_Yr15UsPres <- 100*(exp(alpha_1_7) - 1)
#   p_i_Yr15ChinaEmp <- 100*(exp(alpha_1_8) - 1)
#   p_i_Yr15DalaiLama <- 100*(exp(alpha_1_9) - 1)
#   p_i_Yr15JapanEmp <- 100*(exp(alpha_1_10) - 1)
# 
#   p_i_Yr16UsPres <- 100*(exp(alpha_2_7) - 1)
#   p_i_Yr16ChinaEmp <- 100*(exp(alpha_2_8) - 1)
#   p_i_Yr16DalaiLama <- 100*(exp(alpha_2_9) - 1)
#   p_i_Yr16JapanEmp <- 100*(exp(alpha_2_10) - 1)
# 
#   p_i_Yr17UsPres <- 100*(exp(alpha_3_7) - 1)
#   p_i_Yr17ChinaEmp <- 100*(exp(alpha_3_8) - 1)
#   p_i_Yr17DalaiLama <- 100*(exp(alpha_3_9) - 1)
#   p_i_Yr17JapanEmp <- 100*(exp(alpha_3_10) - 1)
# 
#   p_i_Yr18UsPres <- 100*(exp(alpha_4_7) - 1)
#   p_i_Yr18ChinaEmp <- 100*(exp(alpha_4_8) - 1)
#   p_i_Yr18DalaiLama <- 100*(exp(alpha_4_9) - 1)
#   p_i_Yr18JapanEmp <- 100*(exp(alpha_4_10) - 1)
# 
#   p_i_Yr19UsPres <- 100*(exp(alpha_5_7) - 1)
#   p_i_Yr19ChinaEmp <- 100*(exp(alpha_5_8) - 1)
#   p_i_Yr19DalaiLama <- 100*(exp(alpha_5_9) - 1)
#   p_i_Yr19JapanEmp <- 100*(exp(alpha_5_10) - 1)
# 
#   p_i_Yr20UsPres <- 100*(exp(alpha_6_7) - 1)
#   p_i_Yr20ChinaEmp <- 100*(exp(alpha_6_8) - 1)
#   p_i_Yr20DalaiLama <- 100*(exp(alpha_6_9) - 1)
#   p_i_Yr20JapanEmp <- 100*(exp(alpha_6_10) - 1)
# 
# 
#   # Predictive distribution of age at the new values
#   beta_Francis <- beta_0 + beta_6
#   mu_Francis <- exp(beta_Francis)
#   survival_Francis ~ dweib(r, mu_Francis) %_% T(present_length_Francis, upper_length)
#   age_Francis_predictive <- survival_Francis
# 
#   beta_Obama <- beta_0 + beta_6 + beta_7 + beta_6_7
#   mu_Obama <- exp(beta_Obama)
#   survival_Obama ~ dweib(r, mu_Obama) %_% T(present_length_Obama, upper_length)
#   age_Obama_predictive <- survival_Obama
# 
#   beta_Dalai <- beta_0 + beta_6 + beta_10 + beta_6_10
#   mu_Dalai <- exp(beta_Dalai)
#   survival_Dalai ~ dweib(r, mu_Dalai) %_% T(present_length_Dalai, upper_length)
#   age_Dalai_predictive <- survival_Dalai
# 
#   beta_Naruhito <- beta_0 + beta_6 + beta_9 + beta_6_9
#   mu_Naruhito <- exp(beta_Naruhito)
#   survival_Naruhito ~ dweib(r, mu_Naruhito) %_% T(present_length_Naruhito, upper_length)
#   age_Naruhito_predictive <- survival_Naruhito
# 
#   beta_Benedict <- beta_0 + beta_6
#   mu_Benedict <- exp(beta_Benedict)
#   survival_Benedict ~ dweib(r, mu_Benedict) %_% T(present_length_Benedict, upper_length)
#   age_Benedict_predictive <- survival_Benedict
# 
#   beta_Carter <- beta_0 + beta_6 + beta_7 + beta_6_7
#   mu_Carter <- exp(beta_Carter)
#   survival_Carter ~ dweib(r, mu_Carter) %_% T(present_length_Carter, upper_length)
#   age_Carter_predictive <- survival_Carter
# 
#   beta_Clinton <- beta_0 + beta_6 + beta_7 + beta_6_7
#   mu_Clinton <- exp(beta_Clinton)
#   survival_Clinton ~ dweib(r, mu_Clinton) %_% T(present_length_Clinton, upper_length)
#   age_Clinton_predictive <- survival_Clinton
# 
#   beta_Bush <- beta_0 + beta_6 + beta_7 + beta_6_7
#   mu_Bush <- exp(beta_Bush)
#   survival_Bush ~ dweib(r, mu_Bush) %_% T(present_length_Bush, upper_length)
#   age_Bush_predictive <- survival_Bush
# 
#   beta_Trump <- beta_0 + beta_6 + beta_7 + beta_6_7
#   mu_Trump <- exp(beta_Trump)
#   survival_Trump ~ dweib(r, mu_Trump) %_% T(present_length_Trump, upper_length)
#   age_Trump_predictive <- survival_Trump
# 
#   beta_Akihito <- beta_0 + beta_6 + beta_9 + beta_6_9
#   mu_Akihito <- exp(beta_Naruhito)
#   survival_Akihito ~ dweib(r, mu_Akihito) %_% T(present_length_Akihito, upper_length)
#   age_Akihito_predictive <- survival_Akihito
# 
# }
```

```{r, input-list include = FALSE}
censored_dex = which(censored==1) # index of ppl who are censored

# set numeric vectors for censored ppl
z_censored <- rep(0, length(censored_dex))
t_censored <- censoring_limits[censored_dex]
x_1_censored <- x_1[censored_dex] 
x_2_censored <- x_2[censored_dex] 
x_3_censored <- x_3[censored_dex]
x_4_censored <- x_4[censored_dex]
x_5_censored <- x_5[censored_dex]
x_6_censored <- x_6[censored_dex]
x_7_censored <- x_7[censored_dex]
x_8_censored <- x_8[censored_dex]
x_9_censored <- x_9[censored_dex]
x_10_censored <- x_10[censored_dex] 

x_1_7_censored <- x_1_7[censored_dex] 
x_1_8_censored <- x_1_8[censored_dex] 
x_1_9_censored <- x_1_9[censored_dex] 
x_1_10_censored <- x_1_10[censored_dex] 

x_2_7_censored <- x_2_7[censored_dex] 
x_2_8_censored <- x_2_8[censored_dex] 
x_2_9_censored <- x_2_9[censored_dex] 
x_2_10_censored <- x_2_10[censored_dex] 

x_3_7_censored <- x_3_7[censored_dex] 
x_3_8_censored <- x_3_8[censored_dex] 
x_3_9_censored <- x_3_9[censored_dex] 
x_3_10_censored <- x_3_10[censored_dex] 

x_4_7_censored <- x_4_7[censored_dex] 
x_4_8_censored <- x_4_8[censored_dex] 
x_4_9_censored <- x_4_9[censored_dex] 
x_4_10_censored <- x_4_10[censored_dex] 

x_5_7_censored <- x_5_7[censored_dex] 
x_5_8_censored <- x_5_8[censored_dex] 
x_5_9_censored <- x_5_9[censored_dex] 
x_5_10_censored <- x_5_10[censored_dex] 

x_6_7_censored <- x_6_7[censored_dex] 
x_6_8_censored <- x_6_8[censored_dex] 
x_6_9_censored <- x_6_9[censored_dex] 
x_6_10_censored <- x_6_10[censored_dex] 

n_censored <- length(censored_dex)

# set numeric vectors for non censored ppl
survival_non_censored <- survival[-censored_dex] # Remove ALL ALIVE PEOPLE
x_1_non_censored <- x_1[-censored_dex]
x_2_non_censored <- x_2[-censored_dex]
x_3_non_censored <- x_3[-censored_dex]
x_4_non_censored <- x_4[-censored_dex]
x_5_non_censored <- x_5[-censored_dex]
x_6_non_censored <- x_6[-censored_dex]
x_7_non_censored <- x_7[-censored_dex]
x_8_non_censored <- x_8[-censored_dex]
x_9_non_censored <- x_9[-censored_dex]
x_10_non_censored <- x_10[-censored_dex]

x_1_7_non_censored <- x_1_7[-censored_dex] 
x_1_8_non_censored <- x_1_8[-censored_dex] 
x_1_9_non_censored <- x_1_9[-censored_dex] 
x_1_10_non_censored <- x_1_10[-censored_dex] 

x_2_7_non_censored <- x_2_7[-censored_dex] 
x_2_8_non_censored <- x_2_8[-censored_dex] 
x_2_9_non_censored <- x_2_9[-censored_dex] 
x_2_10_non_censored <- x_2_10[-censored_dex] 

x_3_7_non_censored <- x_3_7[-censored_dex] 
x_3_8_non_censored <- x_3_8[-censored_dex] 
x_3_9_non_censored <- x_3_9[-censored_dex] 
x_3_10_non_censored <- x_3_10[-censored_dex] 

x_4_7_non_censored <- x_4_7[-censored_dex] 
x_4_8_non_censored <- x_4_8[-censored_dex] 
x_4_9_non_censored <- x_4_9[-censored_dex] 
x_4_10_non_censored <- x_4_10[-censored_dex] 

x_5_7_non_censored <- x_5_7[-censored_dex] 
x_5_8_non_censored <- x_5_8[-censored_dex] 
x_5_9_non_censored <- x_5_9[-censored_dex] 
x_5_10_non_censored <- x_5_10[-censored_dex] 

x_6_7_non_censored <- x_6_7[-censored_dex] 
x_6_8_non_censored <- x_6_8[-censored_dex] 
x_6_9_non_censored <- x_6_9[-censored_dex] 
x_6_10_non_censored <- x_6_10[-censored_dex] 

n_non_censored <- length(survival_non_censored)

# find attributes for the four leaders
birth_year_Francis <- leaders_data$Birth.Year[leaders_data$Name == "Francis"]
year_Francis <- birth_year_Francis - mean(leaders_nopred$Birth.Year)
present_length_Francis <- leaders_data$Age.Event[leaders_data$Name =="Francis"]

birth_year_Obama <- leaders_data$Birth.Year[leaders_data$Name == "Barack Obama"]
year_Obama <- birth_year_Obama - mean(leaders_nopred$Birth.Year)
present_length_Obama <- leaders_data$Age.Event[leaders_data$Name =="Barack Obama"]

birth_year_Dalai <- leaders_data$Birth.Year[leaders_data$Name == "14th Dalai Lama (Tenzin Gyatso)"]
year_Dalai <- birth_year_Dalai - mean(leaders_nopred$Birth.Year)
present_length_Dalai <- leaders_data$Age.Event[leaders_data$Name =="14th Dalai Lama (Tenzin Gyatso)"]

birth_year_Naruhito <- leaders_data$Birth.Year[leaders_data$Name == "Naruhito (Emperor Reiwa)"]
year_Naruhito <- birth_year_Naruhito - mean(leaders_nopred$Birth.Year)
present_length_Naruhito <- leaders_data$Age.Event[leaders_data$Name =="Naruhito (Emperor Reiwa)"]

birth_year_Benedict <- leaders_data$Birth.Year[leaders_data$Name == "Benedict XVI)"]
year_Benedict <- birth_year_Benedict - mean(leaders_nopred$Birth.Year)
present_length_Benedict <- leaders_data$Age.Event[leaders_data$Name =="Benedict XVI"]

birth_year_Carter <- leaders_data$Birth.Year[leaders_data$Name == "Jimmy Carter"]
year_Carter <- birth_year_Carter - mean(leaders_nopred$Birth.Year)
present_length_Carter <- leaders_data$Age.Event[leaders_data$Name =="Jimmy Carter"]

birth_year_Clinton <- leaders_data$Birth.Year[leaders_data$Name == "Bill Clinton"]
year_Clinton <- birth_year_Clinton - mean(leaders_nopred$Birth.Year)
present_length_Clinton <- leaders_data$Age.Event[leaders_data$Name =="Bill Clinton"]

birth_year_Bush <- leaders_data$Birth.Year[leaders_data$Name == "George W. Bush"]
year_Bush <- birth_year_Bush - mean(leaders_nopred$Birth.Year)
present_length_Bush <- leaders_data$Age.Event[leaders_data$Name =="George W. Bush"]

birth_year_Trump <- leaders_data$Birth.Year[leaders_data$Name == "Donald Trump"]
year_Trump <- birth_year_Trump - mean(leaders_nopred$Birth.Year)
present_length_Trump <- leaders_data$Age.Event[leaders_data$Name =="Donald Trump"]

birth_year_Akihito <- leaders_data$Birth.Year[leaders_data$Name == "Akihito (Emperor Heisei)"]
year_Akihito <- birth_year_Akihito - mean(leaders_nopred$Birth.Year)
present_length_Akihito <- leaders_data$Age.Event[leaders_data$Name =="Akihito (Emperor Heisei)"]

upper_length <- 100

# build model inputs and run model
data_build_model <- list("n_censored", "n_non_censored", "z_censored", "t_censored",
"x_1_censored", "x_2_censored", "x_3_censored", "x_4_censored", "x_5_censored", "x_6_censored", "x_7_censored", "x_8_censored", "x_9_censored", "x_10_censored","x_1_7_censored", "x_1_8_censored", "x_1_9_censored", "x_1_10_censored","x_2_7_censored", "x_2_8_censored", "x_2_9_censored", "x_2_10_censored",   "x_3_7_censored", "x_3_8_censored", "x_3_9_censored", "x_3_10_censored",  "x_4_7_censored", "x_4_8_censored", "x_4_9_censored", "x_4_10_censored",
"x_5_7_censored", "x_5_8_censored", "x_5_9_censored", "x_5_10_censored","x_6_7_censored", "x_6_8_censored", "x_6_9_censored", "x_6_10_censored","survival_non_censored", "x_1_non_censored", "x_2_non_censored", "x_3_non_censored", "x_4_non_censored", "x_5_non_censored", "x_6_non_censored", "x_7_non_censored", "x_8_non_censored", "x_9_non_censored", "x_10_non_censored","x_1_7_non_censored", "x_1_8_non_censored", "x_1_9_non_censored", "x_1_10_non_censored", "x_2_7_non_censored", "x_2_8_non_censored", "x_2_9_non_censored", "x_2_10_non_censored",   "x_3_7_non_censored", "x_3_8_non_censored", "x_3_9_non_censored", "x_3_10_non_censored",  "x_4_7_non_censored", "x_4_8_non_censored", "x_4_9_non_censored", "x_4_10_non_censored",   "x_5_7_non_censored", "x_5_8_non_censored", "x_5_9_non_censored", "x_5_10_non_censored",  "x_6_7_non_censored", "x_6_8_non_censored", "x_6_9_non_censored", "x_6_10_non_censored",  "present_length_Francis", "present_length_Obama", "present_length_Dalai", "present_length_Naruhito","present_length_Benedict", "present_length_Carter", "present_length_Clinton", "present_length_Bush", "present_length_Trump", "present_length_Akihito", "upper_length")
```

```{r, output-list}
params_to_output = c("beta_0", "beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6", "beta_7", "beta_8", "beta_9", "beta_10", "beta_1_7", "beta_1_8", "beta_1_9", "beta_1_10", "beta_2_7", "beta_2_8", "beta_2_9", "beta_2_10",  "beta_3_7", "beta_3_8", "beta_3_9", "beta_3_10", "beta_4_7", "beta_4_8", "beta_4_9", "beta_4_10",  "beta_5_7", "beta_5_8", "beta_5_9", "beta_5_10",  "beta_6_7", "beta_6_8", "beta_6_9", "beta_6_10", "r", "alpha_0", "alpha_1", "alpha_2", "alpha_3", "alpha_4", "alpha_5", "alpha_6", "alpha_7", "alpha_8", "alpha_9", "alpha_10", "alpha_1_7", "alpha_1_8", "alpha_1_9", "alpha_1_10", "alpha_2_7", "alpha_2_8", "alpha_2_9", "alpha_2_10", "alpha_3_7", "alpha_3_8", "alpha_3_9", "alpha_3_10", "alpha_4_7", "alpha_4_8", "alpha_4_9", "alpha_4_10", "alpha_5_7", "alpha_5_8", "alpha_5_9", "alpha_5_10", "alpha_6_7", "alpha_6_8", "alpha_6_9", "alpha_6_10",  "p_i_Yr15", "p_i_Yr16", "p_i_Yr17", "p_i_Yr18", "p_i_Yr19", "p_i_Yr20",  "p_i_UsPres", "p_i_ChinaEmp", "p_i_DalaiLama", "p_i_JapanEmp","p_i_Yr15_UsPres", "p_i_Yr15_ChinaEmp", "p_i_Yr15_DalaiLama", "p_i_Yr15_JapanEmp", "p_i_Yr16_UsPres", "p_i_Yr16_ChinaEmp", "p_i_Yr16_DalaiLama", "p_i_Yr16_JapanEmp", "p_i_Yr17_UsPres", "p_i_Yr17_ChinaEmp",   "p_i_Yr17_DalaiLama", "p_i_Yr17_JapanEmp", "p_i_Yr18_UsPres", "p_i_Yr18_ChinaEmp",  "p_i_Yr18_DalaiLama", "p_i_Yr18_JapanEmp", "p_i_Yr19_UsPres", "p_i_Yr19_ChinaEmp", "p_i_Yr19_DalaiLama", "p_i_Yr19_JapanEmp", "p_i_Yr20_UsPres", "p_i_Yr20_ChinaEmp", "p_i_Yr20_DalaiLama", "p_i_Yr20_JapanEmp", "age_Francis_predictive", "age_Obama_predictive","age_Dalai_predictive", "age_Naruhito_predictive", "age_Benedict_predictive","age_Carter_predictive", "age_Clinton_predictive", "age_Bush_predictive","age_Trump_predictive","age_Akihito_predictive")
```

```{r, model-priors}
priors = "
  beta_0 ~ dnorm(0.0, 1.0E-3) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1.0E-3) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1.0E-3) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1.0E-3) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1.0E-3) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1.0E-3) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1.0E-3) # Prior on beta_1 is normal with low precision

  r ~ dexp(0.1) # Prior on r
  "
```

```{r, write-model-text}
model_text = function(priors=""){
  file <- tempfile()
  
  likelihood = "#set up likelihood
  for(i in 1:n_censored) {
    z_censored[i] ~ dpois(phi_censored[i])
    phi_censored[i] <- mu_censored[i] * pow(t_censored[i], r)
    mu_censored[i] <- exp(beta_censored[i])
    beta_censored[i] <- beta_0 + beta_1*x_1_censored[i] +
      beta_2*x_2_censored[i] + beta_3*x_3_censored[i] + beta_4*x_4_censored[i] + beta_5*x_5_censored[i] + beta_6*x_6_censored[i] + beta_7*x_7_censored[i] + beta_8*x_8_censored[i] + beta_9*x_9_censored[i] + beta_10*x_10_censored[i] +

    beta_1_7*x_1_7_censored[i] + beta_1_8*x_1_8_censored[i] +  beta_1_9*x_1_9_censored[i] + beta_1_10*x_1_10_censored[i] +

          beta_2_7*x_2_7_censored[i] +
          beta_2_8*x_2_8_censored[i] +
          beta_2_9*x_2_9_censored[i] +
          beta_2_10*x_2_10_censored[i] +

          beta_3_7*x_3_7_censored[i] +
          beta_3_8*x_3_8_censored[i] +
          beta_3_9*x_3_9_censored[i] +
          beta_3_10*x_3_10_censored[i] +

          beta_4_7*x_4_7_censored[i] +
          beta_4_8*x_4_8_censored[i] +
          beta_4_9*x_4_9_censored[i] +
          beta_4_10*x_4_10_censored[i] +

          beta_5_7*x_5_7_censored[i] +
          beta_5_8*x_5_8_censored[i] +
          beta_5_9*x_5_9_censored[i] +
          beta_5_10*x_5_10_censored[i] +

          beta_6_7*x_6_7_censored[i] +
          beta_6_8*x_6_8_censored[i] +
          beta_6_9*x_6_9_censored[i] +
          beta_6_10*x_6_10_censored[i]

  }

  for(j in 1:n_non_censored) { #total rows - 6 ** 6 are censored in leaders_nopred
    survival_non_censored[j] ~ dweib(r, mu[j])
    mu[j] <- exp(beta[j])
    beta[j] <- beta_0 + beta_1*x_1_non_censored[j] +
      beta_2*x_2_non_censored[j] + beta_3*x_3_non_censored[j] + beta_4*x_4_non_censored[j] + beta_5*x_5_non_censored[j] + beta_6*x_6_non_censored[j] + beta_7*x_7_non_censored[j] + beta_8*x_8_non_censored[j] + beta_9*x_9_non_censored[j] + beta_10*x_10_non_censored[j] +

    beta_1_7*x_1_7_non_censored[j] + beta_1_8*x_1_8_non_censored[j] +  beta_1_9*x_1_9_non_censored[j] + beta_1_10*x_1_10_non_censored[j] +

          beta_2_7*x_2_7_non_censored[j] +
          beta_2_8*x_2_8_non_censored[j] +
          beta_2_9*x_2_9_non_censored[j] +
          beta_2_10*x_2_10_non_censored[j] +

          beta_3_7*x_3_7_non_censored[j] +
          beta_3_8*x_3_8_non_censored[j] +
          beta_3_9*x_3_9_non_censored[j] +
          beta_3_10*x_3_10_non_censored[j] +

          beta_4_7*x_4_7_non_censored[j] +
          beta_4_8*x_4_8_non_censored[j] +
          beta_4_9*x_4_9_non_censored[j] +
          beta_4_10*x_4_10_non_censored[j] +

          beta_5_7*x_5_7_non_censored[j] +
          beta_5_8*x_5_8_non_censored[j] +
          beta_5_9*x_5_9_non_censored[j] +
          beta_5_10*x_5_10_non_censored[j] +

          beta_6_7*x_6_7_non_censored[j] +
          beta_6_8*x_6_8_non_censored[j] +
          beta_6_9*x_6_9_non_censored[j] +
          beta_6_10*x_6_10_non_censored[j]
  }
  "
  
  alphas_percentage_pred = "# set up alphas and percentages for interpret
  # define alphas
  alpha_0 <- - beta_0 / r
  alpha_1 <- - beta_1 / r
  alpha_2 <- - beta_2 / r
  alpha_3 <- - beta_3 / r
  alpha_4 <- - beta_4 / r
  alpha_5 <- - beta_5 / r
  alpha_6 <- - beta_6 / r
  alpha_7 <- - beta_7 / r
  alpha_8 <- - beta_8 / r
  alpha_9 <- - beta_9 / r
  alpha_10 <- - beta_10 / r
  
  alpha_1_7 <- - beta_1_7 / r
  alpha_1_8 <- - beta_1_8 / r
  alpha_1_9 <- - beta_1_9 / r
  alpha_1_10 <- - beta_1_10 / r

  alpha_2_7 <- - beta_2_7 / r
  alpha_2_8 <- - beta_2_8 / r
  alpha_2_9 <- - beta_2_9 / r
  alpha_2_10 <- - beta_2_10 / r

  alpha_3_7 <- - beta_3_7 / r
  alpha_3_8 <- - beta_3_8 / r
  alpha_3_9 <- - beta_3_9 / r
  alpha_3_10 <- - beta_3_10 / r

  alpha_4_7 <- - beta_4_7 / r
  alpha_4_8 <- - beta_4_8 / r
  alpha_4_9 <- - beta_4_9 / r
  alpha_4_10 <- - beta_4_10 / r

  alpha_5_7 <- - beta_5_7 / r
  alpha_5_8 <- - beta_5_8 / r
  alpha_5_9 <- - beta_5_9 / r
  alpha_5_10 <- - beta_5_10 / r

  alpha_6_7 <- - beta_6_7 / r
  alpha_6_8 <- - beta_6_8 / r
  alpha_6_9 <- - beta_6_9 / r
  alpha_6_10 <- - beta_6_10 / r


  # Percentage increases
  p_i_Yr15 <- 100*(exp(alpha_1) - 1)
  p_i_Yr16 <- 100*(exp(alpha_2) - 1)
  p_i_Yr17 <- 100*(exp(alpha_3) - 1)
  p_i_Yr18 <- 100*(exp(alpha_4) - 1)
  p_i_Yr19 <- 100*(exp(alpha_5) - 1)
  p_i_Yr20 <- 100*(exp(alpha_6) - 1)
  p_i_UsPres <- 100*(exp(alpha_7) - 1)
  p_i_ChinaEmp <- 100*(exp(alpha_8) - 1)
  p_i_DalaiLama <- 100*(exp(alpha_9) - 1)
  p_i_JapanEmp <- 100*(exp(alpha_10) - 1)

  p_i_Yr15UsPres <- 100*(exp(alpha_1_7) - 1)
  p_i_Yr15ChinaEmp <- 100*(exp(alpha_1_8) - 1)
  p_i_Yr15DalaiLama <- 100*(exp(alpha_1_9) - 1)
  p_i_Yr15JapanEmp <- 100*(exp(alpha_1_10) - 1)

  p_i_Yr16UsPres <- 100*(exp(alpha_2_7) - 1)
  p_i_Yr16ChinaEmp <- 100*(exp(alpha_2_8) - 1)
  p_i_Yr16DalaiLama <- 100*(exp(alpha_2_9) - 1)
  p_i_Yr16JapanEmp <- 100*(exp(alpha_2_10) - 1)

  p_i_Yr17UsPres <- 100*(exp(alpha_3_7) - 1)
  p_i_Yr17ChinaEmp <- 100*(exp(alpha_3_8) - 1)
  p_i_Yr17DalaiLama <- 100*(exp(alpha_3_9) - 1)
  p_i_Yr17JapanEmp <- 100*(exp(alpha_3_10) - 1)

  p_i_Yr18UsPres <- 100*(exp(alpha_4_7) - 1)
  p_i_Yr18ChinaEmp <- 100*(exp(alpha_4_8) - 1)
  p_i_Yr18DalaiLama <- 100*(exp(alpha_4_9) - 1)
  p_i_Yr18JapanEmp <- 100*(exp(alpha_4_10) - 1)

  p_i_Yr19UsPres <- 100*(exp(alpha_5_7) - 1)
  p_i_Yr19ChinaEmp <- 100*(exp(alpha_5_8) - 1)
  p_i_Yr19DalaiLama <- 100*(exp(alpha_5_9) - 1)
  p_i_Yr19JapanEmp <- 100*(exp(alpha_5_10) - 1)

  p_i_Yr20UsPres <- 100*(exp(alpha_6_7) - 1)
  p_i_Yr20ChinaEmp <- 100*(exp(alpha_6_8) - 1)
  p_i_Yr20DalaiLama <- 100*(exp(alpha_6_9) - 1)
  p_i_Yr20JapanEmp <- 100*(exp(alpha_6_10) - 1)

  # Predictive distribution of age at the new values
  beta_Francis <- beta_0 + beta_6
  mu_Francis <- exp(beta_Francis)
  survival_Francis ~ dweib(r, mu_Francis)T(present_length_Francis, upper_length)
  age_Francis_predictive <- survival_Francis

  beta_Obama <- beta_0 + beta_6 + beta_7 + beta_6_7
  mu_Obama <- exp(beta_Obama)
  survival_Obama ~ dweib(r, mu_Obama)T(present_length_Obama, upper_length)
  age_Obama_predictive <- survival_Obama
  
  beta_Dalai <- beta_0 + beta_6 + beta_10 + beta_6_10
  mu_Dalai <- exp(beta_Dalai)
  survival_Dalai ~ dweib(r, mu_Dalai)T(present_length_Dalai, upper_length)
  age_Dalai_predictive <- survival_Dalai

  beta_Naruhito <- beta_0 + beta_6 + beta_9 + beta_6_9
  mu_Naruhito <- exp(beta_Naruhito)
  survival_Naruhito ~ dweib(r, mu_Naruhito)T(present_length_Naruhito, upper_length)
  age_Naruhito_predictive <- survival_Naruhito

  beta_Benedict <- beta_0 + beta_6
  mu_Benedict <- exp(beta_Benedict)
  survival_Benedict ~ dweib(r, mu_Benedict)T(present_length_Benedict, upper_length)
  age_Benedict_predictive <- survival_Benedict

  beta_Carter <- beta_0 + beta_6 + beta_7 + beta_6_7
  mu_Carter <- exp(beta_Carter)
  survival_Carter ~ dweib(r, mu_Carter)T(present_length_Carter, upper_length)
  age_Carter_predictive <- survival_Carter

  beta_Clinton <- beta_0 + beta_6 + beta_7 + beta_6_7
  mu_Clinton <- exp(beta_Clinton)
  survival_Clinton ~ dweib(r, mu_Clinton)T(present_length_Clinton, upper_length)
  age_Clinton_predictive <- survival_Clinton

  beta_Bush <- beta_0 + beta_6 + beta_7 + beta_6_7
  mu_Bush <- exp(beta_Bush)
  survival_Bush ~ dweib(r, mu_Bush)T(present_length_Bush, upper_length)
  age_Bush_predictive <- survival_Bush

  beta_Trump <- beta_0 + beta_6 + beta_7 + beta_6_7
  mu_Trump <- exp(beta_Trump)
  survival_Trump ~ dweib(r, mu_Trump)T(present_length_Trump, upper_length)
  age_Trump_predictive <- survival_Trump

  beta_Akihito <- beta_0 + beta_6 + beta_9 + beta_6_9
  mu_Akihito <- exp(beta_Naruhito)
  survival_Akihito ~ dweib(r, mu_Akihito)T(present_length_Akihito, upper_length)
  age_Akihito_predictive <- survival_Akihito
  "
  
  model_text <- paste("model{ ", likelihood, priors, alphas_percentage_pred, "}")
  writeLines(model_text,con=file)
  return(file)
}
```

```{r, run-model-function}
run_model = function(priors, name) {
  file <- model_text(priors)
  # if (file.exists(name)) {
  #   load(file = name)
  # } else {
    model_output <- jags(data = data_build_model,
                         parameters.to.save =  params_to_output,
                         n.iter = 5000,
                         n.chains = 3,
                         model.file = file)
    save(model_output, file = name)
  #}
  return(model_output)
}

model_output = run_model(priors, "model_used_in_paper") 

model_output
```

# IV. Analysis

As Stander et al (2018) pointed out, following this Weibull distribution, $log(T_i)$ is equal in distribution to $\frac{1}{r} (\beta_0 + \beta_1x_{i1}+\beta_2x_{i2}+...+\beta_9x_{i1}x_{i5}) + \frac{1}{r}\log(\epsilon)$ where $\epsilon \sim exp(1)$. $\alpha_j = -\beta_j/r$, $j = 1,2,...,9$. The interpretation of coefficients depends on the interaction terms (i.e. both year of birth and the type of leadership). 

For example, while keeping all others constant, if a Pope is born one year later, he is expected to live longer by a multiplicative factor of $exp(\alpha_1)$, or his lifespan is expected to increase by a percentage of $100*exp(\alpha_1-1)$. If a U.S. President is born one year later, he is expected to live longer by a multiplicative factor of $exp(\alpha_1 + \alpha_6)$. If a U.S. President and a Chinese Emperor are born in the same year, $y$ after 1677, the Chinese emperor is expected to live longer by a multiplicative factor of $exp(\alpha_3 - \alpha_2 + (\alpha_7-\alpha_6)*y)$ and so on. 

# V. Results

## V a. Output and Interpretation of the Model

```{r tidy-model-table-beta, echo = F}
# # output beta results
# vars = c("beta_0", "beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6", 
#                     "beta_7", "beta_8", "beta_9", "r")
# output <- data.frame(model_output$BUGSoutput$summary)
# output <- output[row.names(output) %in% vars, ]
# coef <- output %>%
#   mutate("Variable" = vars,
#          "Mean" = output$mean,
#          "Standard Deviation" = output$sd,
#          "2.5% Quantile" = output$X2.5.,
#          "Median" = output$X50.,
#          "97.5% Quantile" = output$X97.5.
#          ) %>%
#   select("Variable", "Mean", "Standard Deviation", "2.5% Quantile", "Median", "97.5% Quantile")
# kable(coef)
```

While we may expect leaders who were born earlier to live a shorter life, $\hat{\beta_1}$ which correpsond to the leaders' year of birth appears to be an insignificant parameter as it is very close to 0 (-0.0016) although statistically significant. $\hat{\beta_6}$ to $\hat{\beta_9}$ which correspond to the interaction effects are very weak and mostly insignificant as well. Types of leadership ($\hat{\beta_2}$ to $\hat{\beta_5}$) do seem to be significant. As explained in Section IV, the model is easier to understand if we interpret the output in terms of $\alpha_j$, defined as $\alpha_j = -\beta_j/r$, $j = 1,2,...,9$. Some examples of the interpretation are provided below.

```{r tidy-model-table-alpha, echo = F}
# vars1 = c("alpha_0", "alpha_1", "alpha_2", "alpha_3", "alpha_4", "alpha_5", "alpha_6", 
#          "alpha_7", "alpha_8", "alpha_9", 
#          "percentage_increase_year", "percentage_increase_UsPres", 
#          "percentage_increase_ChinaEmp", "percentage_increase_DalaiLama",
#          "percentage_increase_JapanEmp",
#          "percentage_increase_BYUsPres", "percentage_increase_BYChinaEmp",
#          "percentage_increase_BYDalaiLama", "percentage_increase_BYJapanEmp"
#          )
# output1 <- data.frame(model_output$BUGSoutput$summary)
# output1 <- output[row.names(output1) %in% vars1, ]
# coef1 <- output1 %>%
#   mutate("Variable" = vars1,
#          "Mean" = output1$mean,
#          "Standard Deviation" = output1$sd,
#          "2.5% Quantile" = output1$X2.5.,
#          "Median" = output1$X50.,
#          "97.5% Quantile" = output1$X97.5.
#          ) %>%
#   select("Variable", "Mean", "Standard Deviation", "2.5% Quantile", "Median", "97.5% Quantile")
# kable(coef1)
```

- If a Pope is born one year later, he is expected to live longer by a multiplicative factor of $exp(\alpha_1) = exp(0.0003931) = 1$. This basically means the expected lifespan would hardly change. 
- If a U.S. President is born one year later, he is expected to live longer by a multiplicative factor of $exp(\alpha_1 + \alpha_6) = exp(0.0003931+0.0004852) = 1$. 
- If a U.S. President and a Chinese Emperor were born in the same year 1700, 33 years after the average birth year 1667, the Chinese emperor is expected to live longer by a multiplicative factor of $exp(\alpha_3 - \alpha_2 + (\alpha_7-\alpha_6)*y)$ = exp(-0.31925+0.1449877 + 33*(-0.0001094-0.0004852) = 0.82. That's to say, the Chinese emperor's life expectancy is 18% shorter. 
- If a Japanese Emperor is born 100 years later, he is expected to live longer by a multiplicative factor of $exp(\alpha_9) = exp(100*-0.0000595) = 0.994$, which means the lifespan decreases by 0.6%, whereas for Dalai Lama, the lifespan is expected to increase by a factor of exp(100*-0.0016203) = 0.85, or decrease by 15%. 

Our model also predicts that the 85-year-old 14th Dalai Lama is expected to live 92.4 years (95% credible interval: 85.4 - 99.6 years), the 84-year-old Pope Francis is expected to live 92.4 years (95% credible interval: 84.2 - 99.4 years), the 60-year-old Japanese Emperior Naruhito is expected to live 85.3 years (95% credible interval: 66.4 - 99.5 years) and the 60-year-old former President Barack Obama is expected to live 84.8 years (95% credible interval: 61.5 - 99.4 years). 

## V b. Posterior Inference for the 4 Leaders of Interest

```{r, francis-dalai, message = F, fig.height=5, fig.width=10, echo = FALSE}
people = c("age_Francis_predictive", "age_Obama_predictive", "age_Dalai_predictive",
"age_Naruhito_predictive")
four_pred = data.frame(model_output$BUGSoutput$sims.matrix)[,people]

francis_dalai = data.frame(plifespans = c(four_pred$age_Francis_predictive, four_pred$age_Dalai_predictive), person = c(rep("Francis", nrow(four_pred)), rep("Dalai", nrow(four_pred))))


francis = data.frame(plifespans = four_pred$age_Francis_predictive)
dalai = data.frame(plifespans = four_pred$age_Dalai_predictive)


flab = paste(paste("Current age:", round(min(francis$plifespans),2), "yrs"),
      paste("Median:", round(median(francis$plifespans),2), "yrs"),
      paste("95% quantile:", round(quantile(francis$plifespans, 0.95),2), "yrs"),
      sep = "\n")

dlab = paste(paste("Current age:", round(min(dalai$plifespans),2), "yrs"),
      paste("Median:", round(median(dalai$plifespans),2),"yrs"),
      paste("95% quantile:", round(quantile(dalai$plifespans, 0.95),2), "yrs"),
      sep = "\n")

p1=ggplot(francis, aes(x=plifespans)) + 
  geom_histogram(aes(y=..density..), binwidth = 0.8, boundary=min(francis$plifespans)) +
  geom_vline(aes(xintercept = min(plifespans)), color = "black")+
  geom_vline(aes(xintercept = median(plifespans)), color = "blue")+
  geom_vline(aes(xintercept = quantile(plifespans, 0.95)), color = "red")+
  geom_hline(aes(yintercept = 0), colour = "black") +
  ylim(c(0, 0.1)) + 
  xlab("Lifespan (yrs)") + 
  ggtitle("Pope Francis") +
  theme(plot.title = element_text(hjust = 0.5), axis.title.y = element_blank()) +
  geom_text(mapping = aes(x = 88.5, y = 0.09, label = flab), size = 3)

p2=ggplot(dalai, aes(x=plifespans)) + 
  geom_histogram(aes(y=..density..), binwidth = 0.8, boundary=min(dalai$plifespans)) +
  geom_vline(aes(xintercept = min(plifespans)), color = "black")+
  geom_vline(aes(xintercept = median(plifespans)), color = "blue")+
  geom_vline(aes(xintercept = quantile(plifespans, 0.95)), color = "red")+
  geom_hline(aes(yintercept = 0), colour = "black") +
  ylim(c(0, 0.1)) +
  xlab("Lifespan (yrs)") + 
  ggtitle("Dalai Lama") +
  theme(plot.title = element_text(hjust = 0.5), axis.title.y = element_blank()) +
  geom_text(mapping = aes(x = 89, y = 0.09, label = dlab), size = 3)

cap = paste("Fig. 3a The posterior predictive probability density function of the lifespan for hypothetical leaders with the same attributes as Pope Francis (right) and the 14th Dalai Lama (left).", "The black vertical line marks current age the blue marks posterior median, and the red marks the posterior 95% quantile.", sep = "\n")

grid.arrange(p1,p2, bottom = textGrob(cap, x =0, just = "left", gp = gpar(fontsize = 9) ),
                    left = "Predictive Posterior density", ncol=2)
```


```{r obama-naru-plot, message = F, fig.height=5, fig.width=10, echo = FALSE}
obama = data.frame(plifespans = four_pred$age_Obama_predictive)
naru = data.frame(plifespans = four_pred$age_Naruhito_predictive)

olab = paste(paste("Current age:", round(min(obama$plifespans),2), "yrs"),
      paste("Median:", round(median(obama$plifespans),2),"yrs"),
      paste("95% quantile:", round(quantile(obama$plifespans, 0.95),2), "yrs"),
      sep = "\n")

nlab = paste(paste("Current age:", round(min(naru$plifespans),2), "yrs"),
      paste("Median:", round(median(naru$plifespans),2),"yrs"),
      paste("95% quantile:", round(quantile(naru$plifespans, 0.95),2), "yrs"),
      sep = "\n")

p1=ggplot(obama, aes(x=plifespans)) + 
  geom_histogram(aes(y=..density..), binwidth = 0.8, boundary=min(obama$plifespans)) +
  geom_vline(aes(xintercept = min(plifespans)), color = "black")+
  geom_vline(aes(xintercept = median(plifespans)), color = "blue")+
  geom_vline(aes(xintercept = quantile(plifespans, 0.95)), color = "red")+
  geom_hline(aes(yintercept = 0), colour = "black") +
  ylim(c(0, 0.1)) + 
  xlab("Lifespan (yrs)") + 
  ggtitle("President Obama") +
  theme(plot.title = element_text(hjust = 0.5), axis.title.y = element_blank()) + 
  geom_text(mapping = aes(x = 72, y = 0.09, label = olab), size = 3)

p2=ggplot(naru, aes(x=plifespans)) + 
  geom_histogram(aes(y=..density..), binwidth = 0.8, boundary=min(naru$plifespans)) +
  geom_vline(aes(xintercept = min(plifespans)), color = "black")+
  geom_vline(aes(xintercept = median(plifespans)), color = "blue")+
  geom_vline(aes(xintercept = quantile(plifespans, 0.95)), color = "red")+
  geom_hline(aes(yintercept = 0), colour = "black") +
  ylim(c(0, 0.07)) +
  xlab("Lifespan (yrs)") + 
  ggtitle("Emperor Naruhito") +
  theme(plot.title = element_text(hjust = 0.5), axis.title.y = element_blank()) +
  geom_text(mapping = aes(x = 73, y = 0.06, label = nlab), size = 3)

cap = paste("Fig. 3b The posterior predictive probability density function of the lifespan for hypothetical leaders with the same attributes as Obama (right) and Emperor Naruhito (left).", "The black vertical line marks current age, the blue marks posterior median, and the red marks the posterior 95% quantile.", sep = "\n")

grid.arrange(p1,p2, bottom = textGrob(cap, x =0, just = "left", gp = gpar(fontsize = 9)),
                    left = "Predictive Posterior density", ncol=2)
```

The histogram of the posterior predictive distributions of the lifespans for a leader with the same birth year and leadership type as Pope Francis and that of a leader with the same above attributes as the 14th Dalai Lama are more uniform. The histogram for a leader with the same birth year and leadership type as President Obama and that of a leader with the same above attributes as Emperor Naruhito are both left skewed, with the modes in the late 90s.

```{r posterior-prob-comparison-plots, fig.height=5, fig.width=10, echo=F}
# comparison values
DalaivFrancis = data.frame(as.numeric(four_pred$age_Dalai_predictive-four_pred$age_Francis_predictive))
ObamavNaruhito = data.frame(as.numeric(four_pred$age_Obama_predictive-four_pred$age_Naruhito_predictive))

colnames(DalaivFrancis) = "diff"
colnames(ObamavNaruhito) = "diff"

meandf = mean(DalaivFrancis$diff)
p1=ggplot(DalaivFrancis, aes(x=diff)) + 
  geom_histogram(aes(y = ..density..), binwidth = 1) +
   geom_vline(xintercept = c(meandf),color="blue")+
      ylim(c(0,0.08)) +
      xlab("Difference in Lifespan") +
      theme(axis.title.y = element_blank()) + 
  annotate("text", x = 2, y = 0.04, label = paste("mean =", round(meandf,2)), size=3.5, color = "blue") + 
  labs(caption = paste("Figure 4a. This histogram shows the posterior predictive distribution of the", "difference in lifespan (14th Dalai Lama - Pope Francis).", sep = "\n")) +
    theme(plot.caption = element_text(hjust = 0))

meandf = mean(ObamavNaruhito$diff)
p2=ggplot(ObamavNaruhito, aes(x=diff)) + 
  geom_histogram(aes(y = ..density..), binwidth = 1) +
   geom_vline(xintercept = c(meandf),color="blue")+
      ylim(c(0,0.04)) +
      xlab("Difference in Lifespan") +
      theme(axis.title.y = element_blank()) + 
  annotate("text", x = 0, y = 0.02, label = paste("mean =", round(meandf,2)), size=3.5, color = "blue") + 
  labs(caption = paste("Figure 4b. This histogram shows the posterior predictive distribution of the", "difference in lifespan (Obama - Emperor Naruhito).", sep = "\n")) +
    theme(plot.caption = element_text(hjust = 0))

grid.arrange(p1, p2, left = "Density", ncol=2)
```

```{r posterior-prob-comparison-means, echo=F}
pprob1 = mean(four_pred$age_Dalai_predictive>four_pred$age_Francis_predictive)
pprob2 = mean(four_pred$age_Obama_predictive>four_pred$age_Naruhito_predictive)
```

Figure 4 depicts the distribution of the difference in posterior predictive lifespans between the two sets of leaders this paper focuses on. The probability that the 14th Dalai Lama will have a longer lifespan than Pope Francis is `r round(pprob1,4)`. The probability that President Obama will have a longer lifespan than Emperor Naruhito is `r round(pprob2,4)`.

## V c. MCMC and Model Diagnostics 

The combination of traceplots, lag-1 scatterplots, and acf plots suggest the chain for each parameters converges, and that 50000 iterations is sufficient. Code for those plots are included in appendix A.2. The Rhat's are all close to 1, which is another indicator of converge. All of the effective sample sizes are either close to or greater than 200. Sensitivity analysis was done by using a more informative prior and the resulting estimates remained the same.

```{r standardized-resid, include = F}
# calculate and create graphs for standardized residuals
all_betas = c("beta_0", "beta_1", "beta_2", "beta_3", "beta_4", "beta_5", "beta_6",
              "beta_7", "beta_8", "beta_9", "beta_10", "beta_1_7", "beta_1_8", "beta_1_9",
              "beta_1_10", "beta_2_7", "beta_2_8", "beta_2_9", "beta_2_10","beta_3_7", "beta_3_8",
              "beta_3_9", "beta_3_10", "beta_4_7", "beta_4_8", "beta_4_9", "beta_4_10", "beta_5_7",
              "beta_5_8", "beta_5_9", "beta_5_10", "beta_6_7", "beta_6_8", "beta_6_9", "beta_6_10")

# select only non-living leaders to calculate residuals for
no_living <- leaders_data %>%
  filter(Censored == 0)


data.mat = as.matrix(cbind(x_1, x_2, x_3, x_4, x_5, x_6, x_7, x_8, x_9, x_10, 
                           x_1_7,
                           x_1_8,
                           x_1_9,
                           x_1_10,
                             x_2_7,
                           x_2_8,
                           x_2_9,
                           x_2_10,
                             x_3_7,
                           x_3_8,
                           x_3_9,
                           x_3_10,
                             x_4_7,
                           x_4_8,
                           x_4_9,
                           x_4_10,
                             x_5_7,
                           x_5_8,
                           x_5_9,
                           x_5_10,
                             x_6_7,
                           x_6_8,
                           x_6_9,
                           x_6_10))

pred_res = data.frame(t(model_output$BUGSoutput$summary))
r = pred_res$r[1]
betas = pred_res[,c(all_betas)][1,]

beta.mat = as.matrix(betas[2:length(betas)], nrow = p, byrow = TRUE)
temp = data.mat %*% t(beta.mat)
logmus = as.numeric(betas["beta_0"]) + temp

# draw predicted values based on mus calculated above
set.seed(123)
Ts = rtweibull(n, r, (1/exp(logmus))^(1/r), 0, 100) 

#calculate residuals
resid = leaders_nopred$Age.Event - Ts

#calculate standard deviations
meanTs = mean(Ts)
diff = Ts - meanTs
sd = sqrt((1/n)*(sum((diff)^2)) * (1+ (1/n) + (diff)^2/sum((diff)^2)))
```

```{r resid-v-predictor, fig.height=2, fig.width=5, echo = FALSE}
ggplot(data = leaders_nopred, aes(x = Ts, y = resid/sd)) + geom_point() + 
  labs(x = "Predicted Lifespan", y = "Standardized Residual")
```

```{r resid-v-year, fig.height=2, fig.width=5, echo = FALSE}
ggplot(data = leaders_nopred, aes(x = Birth.Year, y = resid/sd)) + geom_point() +
  labs(x = "Birth Year", y = "Standardized Residual")
```

The standardized residual plot for predicted lifespan shows patterning. It appears that our model tends to overpredict lifespan compared to what was actually observed in many cases. This might be due to the fact that we only have two predictors, Birth Year and Type of Leader. Therefore, we are missing information that might help predict whether or not a leader will die earlier, for example if they have some underlying health condition, etc. 

The standardized residuals when plotted against Birth Year show random scattering, however, and this means that our model is not over or underpredicting lifespan according to the year a leader was born.

```{r, include=F}
 non_censored_prediction <- filter(leaders_data, Censored == 0) #get all of the leaders that are non-censored, as these are the only people that you are able to do posterior predictive checks on, intuitively
 K <- 10 # set the total number of iterations
 ysims <- matrix(nrow = nrow(non_censored_prediction), ncol = K) #create a matrix of the resulting simulations
 
 for(k in 1:K){ #for each iteration
   for(i in 1:nrow(non_censored_prediction)){ #for each row of the non-censored data
     w <- sample(nrow(res), 1) #sample from the model's simulations
     samp <- res[w,] #get the resulting values from the model's random sample
     val <- non_censored_prediction[i, ] #get the resulting values from the specific row
     beta_temp <- samp$beta_0 + samp$beta_1*val$Birth.Year + samp$beta_2*as.integer(val$TypeUsPres) + samp$beta_3*as.integer(val$TypeChinaEmp) + samp$beta_4*as.integer(val$TypeDalaiLama) + samp$beta_5*as.integer(val$TypeJapanEmp) + samp$beta_6*val$Birth.Year*as.integer(val$TypeUsPres) + samp$beta_7*val$Birth.Year*as.integer(val$TypeChinaEmp) + samp$beta_8*val$Birth.Year*as.integer(val$TypeDalaiLama) + samp$beta_9*val$Birth.Year*as.integer(val$TypeJapanEmp) #calculate the beta values as defined by our model
     mu <- exp(beta_temp) #calculate mu from the betas
     t <- rtweibull(1, samp$r, (1/mu)^(1/samp$r), 50, 100) #put the mu and the sample's r value into the weibull equation
     ysims[i, k] <- t #put the resulting value into the ysims matrix
   }
}
```

```{r echo =FALSE}
d <- data.frame(ysims) #create a dataframe from the ysims matrix
d[sapply(d, is.infinite)] <- 100 #set all of the Inf values to the upper truncation value as defined in the previous weibull distribution
```

```{r, echo=F}
#Scatterplot showing Birth Year of the Leaders versues their Age
subset <- filter(leaders_data, Censored == 0)
ggplot(data = subset, aes(x = Birth.Year, Age.Event)) + geom_point(color="pink") + ggtitle("Distribution of Leaders' Ages") + labs(x = "Birth Year", y = "Age")
```

```{r, echo = FALSE}
r <- sample(nrow(non_censored_prediction), 2) #sample from the non_censored data
hist(d[,1], main = "Histogram of Distribution of One Simulated Dataset", xlab = "simulated values for lifespan") #create a histogram for the first column of the dataframe
abline(v=non_censored_prediction$Age.Event[r], col = "red")  #get the ages defined in the data
```

For the posterior predictive checks, it appears that our model returns values that are more concentrated around the upper truncation limit, which is why the dataframe's Inf values are encoded as 100 (the upper truncation limit defined in our function). This follows what the standardized residuals found, where most of the values from the model are left-skewed. 

# VI. Sensitivity Analysis

```{r, sensitivity-1}
priors1 = "
  beta_0 ~ dnorm(0.0, 1) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision

  r ~ dexp(0.001) # Prior on r, Stander et al
  "

sensitivity_1 <- run_model(priors1, "sensitivity1")
```

```{r, sensitivity-2}
priors2 = "
  beta_0 ~ dnorm(0.0, 1) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision

  r ~ dgamma(10,10) # Prior on r, constant hazard
  "

sensitivity_2 <- run_model(priors2, "sensitivity2")
```

```{r, sensitivity-3}
priors3 = "
  beta_0 ~ dnorm(0.0, 1) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1) # Prior on beta_1 is normal with low precision

  r ~ dgamma(10,100) # Prior on r, decreasing hazard
  "

sensitivity_3 <- run_model(priors3, "sensitivity3")
```

```{r, sensitivity-4}
priors4 = "
  beta_0 ~ dnorm(0.0, 1/10000) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1/10000) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1/10000) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1/10000) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1/10000) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1/10000) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1/10000) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1/10000) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1/10000) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision

  r ~ dexp(0.001) # Prior on r, Stander et al
  "

sensitivity_4 <- run_model(priors4, "sensitivity4")
```

```{r, sensitivity-5}
priors5 = "
  beta_0 ~ dnorm(0.0, 1/10000) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1/10000) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1/10000) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1/10000) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1/10000) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1/10000) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1/10000) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1/10000) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1/10000) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision

  r ~ dgamma(10,10) # Prior on r, constant hazard
  "

sensitivity_5 <- run_model(priors5, "sensitivity5")
```

```{r, sensitivity-6}
priors6 = "
  beta_0 ~ dnorm(0.0, 1/10000) # Prior on beta_0 is normal with low precision
  beta_1 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2 ~ dnorm(0.0, 1/10000) # Prior on beta_2 is normal with low precision
  beta_3 ~ dnorm(0.0, 1/10000) # Prior on beta_3 is normal with low precision
  beta_4 ~ dnorm(0.0, 1/10000) # Prior on beta_4 is normal with low precision
  beta_5 ~ dnorm(0.0, 1/10000) # Prior on beta_5 is normal with low precision
  beta_6 ~ dnorm(0.0, 1/10000) # Prior on beta_6 is normal with low precision
  beta_7 ~ dnorm(0.0, 1/10000) # Prior on beta_7 is normal with low precision
  beta_8 ~ dnorm(0.0, 1/10000) # Prior on beta_8 is normal with low precision
  beta_9 ~ dnorm(0.0, 1/10000) # Prior on beta_9 is normal with low precision
  beta_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_1_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_2_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_3_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_4_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_5_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_7 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_8 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_9 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision
  beta_6_10 ~ dnorm(0.0, 1/10000) # Prior on beta_1 is normal with low precision

  r ~ dgamma(10,100) # Prior on r, decreasing hazard
  "

sensitivity_6 <- run_model(priors6, "sensitivity6")
```

```{r, sensitivity-analysis, fig.width=10, fig.height = 5}
parameter = "beta_6"
sa1 = data.frame(sensitivity_1$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa2 = data.frame(sensitivity_2$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa3 = data.frame(sensitivity_3$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa4 = data.frame(sensitivity_4$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa5 = data.frame(sensitivity_5$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa6 = data.frame(sensitivity_6$BUGSoutput$sims.matrix) %>%
  select(parameter)

sa_df = data.frame(vals = rbind(sa1, sa2, sa3, sa4, sa5, sa6),
                   type = c(rep("r~Exp(0.001), B~N(0,1)", nrow(sa1)),
                            rep("r~Ga(10,10), B~N(0,1)", nrow(sa2)),
                            rep("r~Ga(10,1000), B~N(0,1)", nrow(sa3)),
                            rep("r~Exp(0.001), B~N(0,10000)", nrow(sa4)),
                            rep("r~Ga(10,10), B~N(0,10000)", nrow(sa5)),
                            rep("r~Ga(10,1000), B~N(0,10000)", nrow(sa6))))

neworder <- c("r~Exp(0.001), B~N(0,1)", "r~Ga(10,10), B~N(0,1)", "r~Ga(10,1000), B~N(0,1)",
              "r~Exp(0.001), B~N(0,10000)", "r~Ga(10,10), B~N(0,10000)", "r~Ga(10,1000), B~N(0,10000)")

sa_df_plot <- arrange(mutate(sa_df, type=factor(type,levels=neworder)), type)

sampled_vals = model_output$BUGSoutput$summary["beta_6", ]
sampled_beta = sampled_vals["mean"]

ggplot(sa_df_plot) + geom_density(aes(x = beta_6)) + 
  facet_wrap(~type,  scales = "free_y", nrow = 2) + 
  geom_vline(xintercept = sampled_beta, color = "blue") +
  labs(x = expression(beta[6]), caption = paste("Fig. 8 The above plots show sensitivity analysis for different priors on r and the coefficients. The blue line indicates the estimate of the", "coefficient from the propsed model. It appears that the analysis is generally not sensitive to different priors."), size = 3) +
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 4))
``` 

We tested $N(0,1) and N(0,10000)$ priors for the $\beta$'s and $Exp(0.001)$ (Stander et al prior), $Gamma(10,10)$ (mean = 1), and $Gamma(10,100)$ (mean = 0.1) priors for $r$. Distribution of $\beta_6$ was approximated using those different priors and plotted above.The blue line, which is estimate from our model crosses, or is close to the mode of all but one of the distributions, so our analysis is mostly robust against changes in prior. However, it is somewhat sensitive to the prior combination $r \sim Gamma(10,1000)$ and $\beta_6 ~ N(0,1)$ Code to conduct ensitivity analysis for the remaining betas can be found in appendix A.3.

# VII. Cross Validation

```{r}
#read data
monarchs <- read.csv("english_monarchs.csv", header = FALSE)
monarchs$Age <- as.numeric(monarchs$V3) - as.numeric(monarchs$V2)
monarchs <- monarchs %>%
  filter(V2 >= 1300)
```

```{r}
monarchs$Age[monarchs$V1 == "Elizabeth II"] <- 94
```

```{r}
monarchs$Censored <- 0
monarchs$Censored[monarchs$V1 == "Elizabeth II"] <- 1
```

```{r}
monarchs$survival <- monarchs$Age
monarchs$survival[monarchs$V1 == "Elizabeth II"] <- NA
```

```{r}
monarchs$TypeJapanEmp <- 1
monarchs <- monarchs %>%
  mutate(Yr14 = as.factor(case_when(V2 <= 1400 ~1,
                                        TRUE ~0)),
         Yr15 = as.factor(case_when(V2 >= 1401 & V2 <= 1500 ~ 1,
                                         TRUE ~0)),
         Yr16 = as.factor(case_when(V2 >= 1501 & V2 <= 1600 ~ 1,
                                         TRUE ~0)),
         Yr17 = as.factor(case_when(V2 >= 1601 & V2 <= 1700 ~ 1,
                                         TRUE ~0)),
         Yr18 = as.factor(case_when(V2 >= 1701 & V2 <= 1800 ~ 1,
                                         TRUE ~0)),
         Yr19 = as.factor(case_when(V2 >= 1801 & V2 <= 1900 ~ 1,
                                         TRUE ~0)),
         Yr20 = as.factor(case_when(V2 >= 1901 & V2 <= 2000 ~ 1,
                                         TRUE ~0))
         ) 

z_1 <- as.numeric(as.character(monarchs$Yr15))
z_2 <- as.numeric(as.character(monarchs$Yr16))
z_3 <- as.numeric(as.character(monarchs$Yr17))
z_4 <-  as.numeric(as.character(monarchs$Yr18))
z_5 <-  as.numeric(as.character(monarchs$Yr19))
z_6 <-  as.numeric(as.character(monarchs$Yr20))
z_7 <- 0
z_8 <- 0
z_9 <- 0
z_10 <- as.numeric(as.character(monarchs$TypeJapanEmp))

# add interaction b/w Yr__ and Type___
z_1_7 <- z_1*z_7; z_1_8 <- z_1*z_8; z_1_9 <- z_1*z_9; z_1_10 <- z_1*z_10

z_2_7 <- z_2*z_7
z_2_8 <- z_2*z_8
z_2_9 <- z_2*z_9
z_2_10 <- z_2*z_10

z_3_7 <- z_3*z_7
z_3_8 <- z_3*z_8
z_3_9 <- z_3*z_9
z_3_10 <- z_3*z_10

z_4_7 <- z_4*z_7
z_4_8 <- z_4*z_8
z_4_9 <- z_4*z_9
z_4_10 <- z_4*z_10

z_5_7 <- z_5*z_7
z_5_8 <- z_5*z_8
z_5_9 <- z_5*z_9
z_5_10 <- z_5*z_10

z_6_7 <- z_6*z_7
z_6_8 <- z_6*z_8
z_6_9 <- z_6*z_9
z_6_10 <- z_6*z_10

cv_data.mat = as.matrix(cbind(z_1, z_2, z_3, z_4, z_5, z_6, z_7, z_8, z_9, z_10, 
                           z_1_7,
                           z_1_8,
                           z_1_9,
                           z_1_10,
                             z_2_7,
                           z_2_8,
                           z_2_9,
                           z_2_10,
                             z_3_7,
                           z_3_8,
                           z_3_9,
                           z_3_10,
                             z_4_7,
                           z_4_8,
                           z_4_9,
                           z_4_10,
                             z_5_7,
                           z_5_8,
                           z_5_9,
                           z_5_10,
                             z_6_7,
                           z_6_8,
                           z_6_9,
                           z_6_10))

beta.mat = as.matrix(betas[2:length(betas)], nrow = p, byrow = TRUE)
temp = cv_data.mat %*% t(beta.mat)
logmus = as.numeric(betas["beta_0"]) + temp

# draw predicted values based on mus calculated above
set.seed(123)
cv_n = nrow(monarchs)
Ts = rtweibull(cv_n, r, (1/exp(logmus))^(1/r), 0, 100) 

#calculate residuals
resid = monarchs$Age - Ts

#calculate standard deviations
meanTs = mean(Ts)
diff = Ts - meanTs
sd = sqrt((1/n)*(sum((diff)^2)) * (1+ (1/n) + (diff)^2/sum((diff)^2)))
```

```{r resid-v-predictor, fig.height=2, fig.width=5, echo = FALSE}
ggplot(data = monarchs, aes(x = Ts, y = resid/sd)) + geom_point() + 
  labs(x = "Predicted Lifespan", y = "Standardized Residual")
```


```{r resid-v-year, fig.height=2, fig.width=5, echo = FALSE}
ggplot(data = monarchs, aes(x = V2, y = resid/sd)) + geom_point() +
  labs(x = "Birth Year", y = "Standardized Residual")
```
*write about how external cross validation looks bad*


# VI. Conclusion and Further Discussion

We sought to compare Popes, US Presidents, Dalai Lamas, Chinese Emperors, and Japanese Emperors to see how their lifespans compare. Our model has found that the impact of birth year on lifespan does not change based on leadership type. Additionally, our model has found that lifespan does depend on year of birth, but the association is not strong. 

This model could be improved by including more predictors; for ezample, health varies widely among people, and could lead to a better model for prediction. For further implementations of this research question, it would be valuable to interpret economic or quality of life data as it concerns the different countries that the leaders grew up in, as the conditions that a person live in lead to changes in a person's lifespan. 

# VII. References

Stander, J., Dalla Valle, L., and Cortina-Borja, M. (2018). A Bayesian Survival Analysis of a Historical Dataset: How Long Do Popes Live? The American Statistician 72(4):368-375.

# VIII. Appendix

# # A.1 Details on the Poisson "Zero-Trick" Method

We use the Poisson "zeros trick," where a set of 0's are created and the likelihood of observing an 0 follows a $Poisson(\phi_i)$ distribution. The likelihood $L_i$ is $Pr(z_i = 0) = exp(-\phi)$. In other words, $\phi_i$ equals $-log(L_i)$. This mechanism is necessary because we don't know the lifespan of currently living people, so we need a way to model their expected survival times. The censored vector has 0 for dead leaders and 1 for alive leaders. The vector censoring_limits contains 100 (chosen as an upper bound on age) for dead leaders and current age for alive leaders. The non-100 observations in censoring_limits are saved in t_censored, and t_censored is taken to the power of r then multiplied by mu_censored to calculate phi_censored, which is the mean parameter of the Poisson likelihood described above.

# # A.2 Code for Traceplots, Lag-1 Scatterplots, and Acf Plots

```{r, echo = FALSE}
# run traceplots
parameters = c(all_betas, "r")

res = data.frame(model_output$BUGSoutput$sims.matrix)[,parameters]
colnames(res) <- gsub("^.*\\.","", colnames(res) )

tps <- function(var){
  ggplot(res, aes_(y=as.name(var), x=seq(1,nrow(res)))) +
    geom_line() +
    labs(title=paste("Traceplot of ", as.name(var)),
         x ="Iterations", y = as.name(var))
}

all_trace = lapply(names(res), tps)

p1 = all_trace[1:11]
p2 = all_trace[12:22]
p3 = all_trace[23:33]

do.call(grid.arrange, p1)
do.call(grid.arrange, p2)
do.call(grid.arrange, p3)
```

```{r, include = FALSE}
# run lag-1 scatterplots
library(ggplot2)
res_lag1 = lapply(seq(1:length(res)), function(i) {
  lres = lag(res[,i],1)
  plot(y=res[,i], x= lres, 
       xlab = paste0(colnames(res)[i], "-1"),
       ylab = paste0(colnames(res)[i]),
       main = paste("Lag-1 Scatter Plot of", colnames(res)[i]))
})


```

```{r, include = FALSE}
# run acf plots
lapply(seq(1,length(res)), function(i) { 
  acf(res[,i], xlab = "Lag", ylab = "ACF", 
            main = paste("ACF Plot of ", colnames(res)[i]))
})
```

*add old model and resid code here*

# # A.3 Code for Sensitivity Analysis

```{r}
parameter = "beta_6" # change parameter here to run for different betas

sa1 = data.frame(sensitivity_1$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa2 = data.frame(sensitivity_2$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa3 = data.frame(sensitivity_3$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa4 = data.frame(sensitivity_4$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa5 = data.frame(sensitivity_5$BUGSoutput$sims.matrix) %>%
  select(parameter)
sa6 = data.frame(sensitivity_6$BUGSoutput$sims.matrix) %>%
  select(parameter)

sa_df = data.frame(vals = rbind(sa1, sa2, sa3, sa4, sa5, sa6),
                   type = c(rep("r~Exp(0.001), B~N(0,1)", nrow(sa1)),
                            rep("r~Ga(10,10), B~N(0,1)", nrow(sa2)),
                            rep("r~Ga(10,1000), B~N(0,1)", nrow(sa3)),
                            rep("r~Exp(0.001), B~N(0,100)", nrow(sa4)),
                            rep("r~Ga(10,10), B~N(0,100)", nrow(sa5)),
                            rep("r~Ga(10,1000), B~N(0,100)", nrow(sa6))))

neworder <- c("r~Exp(0.001), B~N(0,1)", "r~Ga(10,10), B~N(0,1)", "r~Ga(10,1000), B~N(0,1)",
              "r~Exp(0.001), B~N(0,100)", "r~Ga(10,10), B~N(0,100)", "r~Ga(10,1000), B~N(0,100)")

sa_df_plot <- arrange(mutate(sa_df, type=factor(type,levels=neworder)), type)

sampled_vals = model_output$BUGSoutput$summary[parameter, ]
sampled_beta = sampled_vals["mean"]

ggplot(sa_df_plot) + geom_density(aes(x = sa_df_plot[,1])) + 
  facet_wrap(~type,  scales = "free_y", nrow = 2) + 
  geom_vline(xintercept = sampled_beta, color = "blue") +
  labs(x = expression(beta[6]), caption = paste("Fig. 8 The above plots show sensitivity analysis for different priors on r and the coefficients. The blue line indicates the estimate of the", "coefficient from the propsed model. It appears that the analysis is generally not sensitive to different priors."), size = 3) + # change beta[6] to beta being analyzed
  theme(plot.caption = element_text(hjust = 0.5, vjust = -0.5, size = 4))
```
